#!/bin/bash

set -o nounset

VERSION="$(cat VERSION)"
CONFIG_BREW=OFF
BIN_DIR=/bin
LIB_DIR=/share/procfetch

#
# parse options
#

if [[ $# -ge 1 && ${1%%=*} == --prefix ]]; then
    PREFIX="${1##*=}"
    shift
fi

if [[ $# -ne 0 ]]; then
    echo "Error: Invalid options or arguments"
    echo "Usage: $0 [--prefix=<prefix>]"
    exit 1
fi

#
# main process
#

BIN_DIR="${PREFIX:-}${BIN_DIR}"
LIB_DIR="${PREFIX:-/usr}${LIB_DIR}"

for f in Makefile ascii/Makefile src/Makefile src/config.h Doxyfile
do
    echo "creating $f"
    sed -e "s/@VERSION@/${VERSION}/g" \
        -e "s:@BIN_DIR@:${BIN_DIR}:g" \
        -e "s:@LIB_DIR@:${LIB_DIR}:g" "$f.in" > "$f"
done
