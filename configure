#!/bin/bash

set -o nounset

VERSION=$(cat VERSION)
CONFIG_BREW=OFF
BIN_DIR="/bin"
LIB_DIR="/usr/share/procfetch"

#
# parse options
#

if [[ $# -ge 2 && $1 == "-C" && $2 == "brew" ]]; then
    shift 2
    CONFIG_BREW=ON
fi

if [[ $# -ne 0 ]]; then
    echo "Error: Invalid options or arguments"
    echo "Usage: $0 [-C brew]"
    exit 1
fi

#
# main process
#

if [[ $CONFIG_BREW == "ON" ]]; then
    BIN_DIR="${HOMEBREW_PREFIX:-}/bin"
    LIB_DIR="${HOMEBREW_PREFIX:-}/procfetch"
fi

for f in Makefile ascii/Makefile src/Makefile src/config.h Doxyfile
do
    echo "creating $f"
    sed -e "s/@VERSION@/${VERSION}/g" \
        -e "s:@BIN_DIR@:${BIN_DIR}:g" \
        -e "s:@LIB_DIR@:${LIB_DIR}:g" $f.in > $f
done
